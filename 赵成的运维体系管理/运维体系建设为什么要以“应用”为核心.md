# 运维体系建设为什么要以“应用”为核心

在微服务的架构模式下，我们的运维视角一定转到应用这个核心概念上来，一切要从应用的角度来分析和看待问题。

1. 软件系统中，基础设施和组件都是为上层的一个个业务应用所服务的，识别和建立它们之间的关系的非常重要，这个是运维体系化的前提。
2. 要从应用的视角去看这些基础服务，不要将它们与应用割裂。
3. 应用运维层面管理混乱，运维无法场景化，流程无法闭环，首要看是不是忽略了应用这个核心。

## 应用的起源

软件架构服务化的过程，就是我们根据业务模型进行细化的过程，在这个过程中切分出一个个具备不同职责的业务逻辑模块，然后每个微服务模块都会提供相对应业务逻辑的服务化接口。

## 应用模型及关系模型的建立

除了应用这个实体之外，还会存在其他各类基础组件实体。同时，在应用运行过程中，还需要不断地与它们产生和建立各种各样复杂的关联关系，这也为我们后续的运维带来很多困难。

那接下来，我们要做的就是应用模型以及各种关系模型的梳理和建立，因为只有模型和关系梳理清楚了，才能为我们后面一系列的运维自动化、持续交付以及稳定性保障打下一个良好的基础。

### 应用业务模型

也就是每个应用对外提供的业务服务能力，并以 API 的方式暴露给外部，业务模型通常都是业务架构师在进行业务需求分析和拆解时进行设计，更多的是聚焦在业务逻辑上，所以从运维的角度，我们一般不会关注太多。

### 应用管理模型

应用管理模型，也就是应用自身的各种属性，如应用名、应用功能信息、责任人、Git 地址、部署结构（代码路径、日志路径以及各类配置文件路径等）、启停方式、健康检测方式等等。

### 应用运行时所依赖的基础设施和组件

- **资源层面：**应用运行所必需的资源载体有物理机、虚拟机或容器等，如果对外提供 HTTP 服务，就需要虚 IP 和 DNS 域名服务。
- **基础组件：**这一部分其实就是我们所说的中间件体系，比如应用运行过程中必然要存储和访问数据，这就需要有数据库和数据库中间件；想要更快地访问数据，同时减轻 DB 的访问压力，就需要缓存；应用之间如果需要数据交互或同步，就需要消息队列；如果进行文件存储和访问，就需要存储系统等等。

**这些基础设施和组件都是为上层的一个个业务应用所服务的，始至终基础设施和组件都跟应用这个概念保持着紧密的联系。**

第一步，建立各个基础设施和组件的数据模型，同时识别出它们的唯一标识。

第二步，也是最关键的一步，就是识别出基础设施及组件可以与应用名 AppName 建立关联关系的属性，或者在基础组件的数据模型中增加所属应用这样的字段，通过外键关联模式建立起应用与缓存空间的关联关系。

相应地，对于消息队列、DB、存储空间等，都可以参考上面这个思路去做。

建立出以应用为核心的应用模型和关联关系模型，基于这个统一的应用概念，系统中原本分散杂乱的信息，最终都被串联了起来，应用也将成为整个运维信息管理及流转的纽带。

- 场景一
    
    线上就存在一堆无用的 NameSpace 和 Topic，但是集群的维护者又不敢随意清理，因为早就搞不清楚是谁用的
    
    根本原因：没有与应用的访问建立起关联关系，没有任何的生命周期管理措施
    
- 场景二
    
    系统需要对接时，就会发现需要做大量的应用名转化适配工作，带来非常多无谓的工作量
    
    微服务架构模式下的运维思路一定要转变，一定要将视角转换到应用这个维度，从一开始就要统一规划，从一开始就要将架构、开发和运维的工作拉通了去看，这一点是与传统运维的思路完全不同的。我们要转换视角，规划以应用为核心的运维管理体系